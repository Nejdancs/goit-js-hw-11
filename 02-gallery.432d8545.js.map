{"mappings":"iiBAAA,IAAAA,EAAAC,EAAA,S,4BAQIC,EACAC,EACAC,E,oDAEEC,EAAW,IAAIC,E,YAAJ,CAAmB,aAAc,CAChDC,aAAc,MACdC,aAAc,IACdC,eAAgB,KA4BlB,SAASC,IACP,IAEMC,EAFQC,EAAAC,QAAKC,QAESC,aAK5B,GAJgBC,OAAOC,YACDD,OAAOE,aAGpBP,EAAe,CAItB,GAHAT,GAAQ,EACRiB,oBAAoB,SAAUT,GAE1BR,EAAOC,EAKT,YAJAiB,EAAAC,OAAOC,QACL,8DAMJC,EAAanB,EAAkBF,I,SAIpBqB,EAAaC,EAAOC,G,OAApBC,EAAYC,MAAAC,KAAAC,W,SAAZH,I,OAAAA,EAAfpB,EAAAN,EAAA,CAAAM,EAAAwB,GAAAC,MAAA,SAAAC,EAA4BR,EAAOC,G,IAIHQ,EAApBC,EAAMC,E,kFAFdC,I,UAEkC,EAAAC,EAAAxB,SAAUW,EAAOC,G,UAAvBQ,EAA4BK,EAAAC,KAAhDL,EAAoBD,EAApBC,KAAMC,EAAcF,EAAdE,UAEdC,IACAI,EAAgBL,GAEE,IAAdA,EAAe,C,uBACjBf,EAAAC,OAAOoB,QACL,4E,2BAIgB,IAAThB,GACTL,EAAAC,OAAOqB,KAAK,oBAA8BC,OAAVR,EAAU,a,QAG5CvB,EAAAC,QAAKC,QAAQ8B,mBAAmB,aAAa,EAAAC,EAAAhC,SAAYqB,IACzD7B,EAASyC,UACTC,IACAC,iBAAiB,SAAUtC,G,kDAE3BuC,QAAQC,IAAIZ,EAAAa,GAAMC,SAClBhB,IACAhB,EAAAC,OAAOoB,QAAQ,iD,2DA1BQd,MAAAC,KAAAC,WA8B3B,SAASkB,IACP,IACIM,EADIC,EAAuB1C,EAAAC,QAAK0C,KAAKC,wBAAjCC,OAGK,IAATvD,IACFmD,EAAYC,EAEZtC,OAAO0C,SAAS,CACdC,IAAKN,EACLO,SAAU,YAKhB,SAASpB,EAAgBL,GACvBhC,EAAa0D,KAAKC,KAAK3B,EAAY,IAGrC,SAASC,IACPxB,EAAAC,QAAKkD,QAAQC,UAAUC,OAAO,aAlGhCrD,EAAAC,QAAK0C,KAAKP,iBAAiB,UAE3B,SAAkBkB,GAChBA,EAAEC,iBAEF,IAIMC,EAFFF,EAAEG,cADJC,SAAYC,YAGsB/C,MAAMgD,OAM1C,GALApE,EAAmBgE,EAEnBxD,EAAAC,QAAKC,QAAQ2D,UAAY,GACzBvE,EAAO,GAEFE,EAEH,YADAgB,EAAAC,OAAOqB,KAAK,8BAIdnB,EAAanB,EAAkBF,GAE/BgE,EAAEG,cAAcK,W","sources":["src/js/02-gallery.js"],"sourcesContent":["import './scroll-form.js';\nimport refs from './refs';\nimport getImages from './fetch-service';\nimport createCards from './create-cards';\nimport { Notify } from 'notiflix/build/notiflix-notify-aio';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nlet page;\nlet totalPages;\nlet valueSearchQuery;\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n  overlayOpacity: 0.8,\n});\n\nrefs.form.addEventListener('submit', onSearch);\n\nfunction onSearch(e) {\n  e.preventDefault();\n\n  const {\n    elements: { searchQuery },\n  } = e.currentTarget;\n\n  const normalizedValue = searchQuery.value.trim();\n  valueSearchQuery = normalizedValue;\n\n  refs.gallery.innerHTML = '';\n  page = 1;\n\n  if (!valueSearchQuery) {\n    Notify.info(\"You didn't enter anything.\");\n    return;\n  }\n\n  renderImages(valueSearchQuery, page);\n\n  e.currentTarget.reset();\n}\n\nfunction onScroll() {\n  const block = refs.gallery;\n\n  const contentHeight = block.offsetHeight;\n  const yOffset = window.pageYOffset;\n  const window_height = window.innerHeight;\n  const y = yOffset + window_height;\n\n  if (y >= contentHeight) {\n    page += 1;\n    removeEventListener('scroll', onScroll);\n\n    if (page > totalPages) {\n      Notify.warning(\n        \"We're sorry, but you've reached the end of search results.\"\n      );\n\n      return;\n    }\n\n    renderImages(valueSearchQuery, page);\n  }\n}\n\nasync function renderImages(value, page) {\n  try {\n    toggleSpiner();\n\n    const { hits, totalHits } = await getImages(value, page);\n\n    toggleSpiner();\n    checkTotalPages(totalHits);\n\n    if (totalHits === 0) {\n      Notify.failure(\n        'Sorry, there are no images matching your search query. Please try again.'\n      );\n\n      return;\n    } else if (page === 1) {\n      Notify.info(`Hooray! We found ${totalHits} images.`);\n    }\n\n    refs.gallery.insertAdjacentHTML('beforeend', createCards(hits));\n    lightbox.refresh();\n    scroll();\n    addEventListener('scroll', onScroll);\n  } catch (error) {\n    console.log(error.message);\n    toggleSpiner();\n    Notify.failure('Oops, something went wrong. Please try again.');\n  }\n}\n\nfunction scroll() {\n  const { height: formHeight } = refs.form.getBoundingClientRect();\n  let topScroll;\n\n  if (page === 1) {\n    topScroll = formHeight;\n\n    window.scrollBy({\n      top: topScroll,\n      behavior: 'smooth',\n    });\n  }\n}\n\nfunction checkTotalPages(totalHits) {\n  totalPages = Math.ceil(totalHits / 40);\n}\n\nfunction toggleSpiner() {\n  refs.spinner.classList.toggle('is-hidden');\n}\n"],"names":["$61aA4","parcelRequire","$1e6356691b114c54$var$page","$1e6356691b114c54$var$totalPages","$1e6356691b114c54$var$valueSearchQuery","$1e6356691b114c54$var$lightbox","$parcel$interopDefault","captionsData","captionDelay","overlayOpacity","$1e6356691b114c54$var$onScroll","contentHeight","$lfmFS","default","gallery","offsetHeight","window","pageYOffset","innerHeight","removeEventListener","$aOaai","Notify","warning","$1e6356691b114c54$var$renderImages","value","page1","$1e6356691b114c54$var$_renderImages","apply","this","arguments","$5eMmT","mark","_callee","ref","hits","totalHits","$1e6356691b114c54$var$toggleSpiner","$fPt28","_ctx","sent","$1e6356691b114c54$var$checkTotalPages","failure","info","concat","insertAdjacentHTML","$jV7Iq","refresh","$1e6356691b114c54$var$scroll","addEventListener","console","log","t0","message","topScroll","formHeight","form","getBoundingClientRect","height","scrollBy","top","behavior","Math","ceil","spinner","classList","toggle","e","preventDefault","normalizedValue","currentTarget","elements","searchQuery","trim","innerHTML","reset"],"version":3,"file":"02-gallery.432d8545.js.map"}